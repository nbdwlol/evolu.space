<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>evolu space – login / signup</title>
<link rel="icon" href="/favicon.ico" />
<!-- supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --yellow: #ffb700;
    --yellow-dark: #ffa500;
    --bg-a: #fff799;
    --bg-b: #ffea5c;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }

  html, body { height: 100%; }

  body {
    background: linear-gradient(135deg, var(--bg-a), var(--bg-b));
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px;
    min-height: 100vh;
    text-transform: lowercase;
  }

  /* card */
  .card {
    width: 380px;
    max-width: 100%;
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 18px 50px rgba(0,0,0,0.12);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;          /* center children horizontally */
    padding: 20px 20px 28px;
  }

  /* header image */
  .card .logo {
    width: 96px;
    height: 96px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid var(--yellow);
    margin-bottom: 14px;
    background: #fff;
  }

  /* tabs row */
  .tabs {
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 12px;
  }
  .tab {
    padding: 8px 14px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    background: rgba(0,0,0,0.03);
    color: #222;
    transition: all .18s ease;
  }
  .tab.active {
    background: var(--yellow);
    color: #fff;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }

  /* inner container keeps inputs/button centered and limited width */
  .form-inner {
    width: 100%;
    max-width: 320px;    /* controls horizontal width of inputs */
    margin: 0 auto;
  }

  h2 {
    color: var(--yellow);
    font-size: 1.05rem;
    font-weight: 700;
    margin-bottom: 10px;
    text-align: center;
  }

  form {
    display: none;
    width: 100%;
  }
  form.active { display: block; }

  .field {
    margin-bottom: 12px;
  }

  input[type="text"],
  input[type="email"],
  input[type="password"] {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid #eee;
    outline: none;
    font-size: 1rem;
  }
  input::placeholder { color: #9a9a9a; opacity: .9; }

  input:focus {
    border-color: var(--yellow);
    box-shadow: 0 6px 18px rgba(255,183,0,0.08);
  }

  button.submit {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: var(--yellow);
    color: #fff;
    font-weight: 700;
    cursor: pointer;
    font-size: 1rem;
  }
  button.submit:hover { background: var(--yellow-dark); }

  .message {
    margin-top: 10px;
    font-size: 0.92rem;
    text-align: center;
    min-height: 20px;
  }
  .message.error { color: #c82323; }
  .message.success { color: #14794d; }

  /* ensure card never gets taller than viewport on short phones */
  @media (max-height: 600px) {
    .card {
      max-height: 94vh;
      padding: 12px;
      overflow-y: auto;
    }
    .form-inner { max-width: 100%; padding-bottom: 8px; }
  }

  /* extra mobile tweaks */
  @media (max-width: 420px) {
    .card { padding: 14px; }
    .logo { width: 84px; height:84px; margin-bottom:10px; }
    input, button.submit { padding: 12px; font-size: 0.98rem; }
  }
</style>
</head>
<body>

  <div class="card" role="main" aria-labelledby="card-title">
    <!-- top image: change src to your logo/avatar -->
    <img class="logo" src="/assets/default.png" alt="evolu logo" />

    <div class="tabs" role="tablist" aria-label="auth tabs">
      <div id="login-tab" class="tab active" role="tab" aria-selected="true">login</div>
      <div id="signup-tab" class="tab" role="tab" aria-selected="false">signup</div>
    </div>

    <div class="form-inner">
      <!-- login form -->
      <form id="login-form" class="active" aria-hidden="false">
        <h2 id="card-title">login</h2>
        <div class="field"><input id="login-email" type="email" placeholder="email" required /></div>
        <div class="field"><input id="login-password" type="password" placeholder="password" required /></div>
        <div class="field"><button class="submit" type="submit">login</button></div>
        <div id="login-message" class="message" aria-live="polite"></div>
      </form>

      <!-- signup form -->
      <form id="signup-form" aria-hidden="true">
        <h2>signup</h2>
        <div class="field"><input id="signup-username" type="text" placeholder="username" required /></div>
        <div class="field"><input id="signup-email" type="email" placeholder="email" required /></div>
        <div class="field"><input id="signup-password" type="password" placeholder="password" required /></div>
        <div class="field"><button class="submit" type="submit">signup</button></div>
        <div id="signup-message" class="message" aria-live="polite"></div>
      </form>
    </div>
  </div>

<script>
/*  Replace with your Supabase details */
const SUPABASE_URL = "https://your-project.supabase.co"; // <--- replace
const SUPABASE_KEY = "your-anon-key";                  // <--- replace

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* UI elements */
const loginTab = document.getElementById('login-tab');
const signupTab = document.getElementById('signup-tab');
const loginForm = document.getElementById('login-form');
const signupForm = document.getElementById('signup-form');
const loginMessage = document.getElementById('login-message');
const signupMessage = document.getElementById('signup-message');

/* helper */
function setActive(tabName) {
  if (tabName === 'login') {
    loginTab.classList.add('active');
    signupTab.classList.remove('active');
    loginForm.classList.add('active');
    signupForm.classList.remove('active');
    loginForm.setAttribute('aria-hidden','false');
    signupForm.setAttribute('aria-hidden','true');
  } else {
    signupTab.classList.add('active');
    loginTab.classList.remove('active');
    signupForm.classList.add('active');
    loginForm.classList.remove('active');
    signupForm.setAttribute('aria-hidden','false');
    loginForm.setAttribute('aria-hidden','true');
  }
}

/* tab clicks */
loginTab.addEventListener('click', () => setActive('login'));
signupTab.addEventListener('click', () => setActive('signup'));

/* show messages */
function show(el, text, type = 'error') {
  el.textContent = text;
  el.className = `message ${type}`;
}

/* SIGNUP */
signupForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  signupMessage.textContent = '';

  const username = document.getElementById('signup-username').value.trim();
  const email = document.getElementById('signup-email').value.trim();
  const password = document.getElementById('signup-password').value;

  if (!username || !email || !password) return show(signupMessage, 'please fill all fields', 'error');

  const { data, error: signErr } = await supabaseClient.auth.signUp({ email, password });
  if (signErr) return show(signupMessage, signErr.message, 'error');

  const user = data.user;
  if (!user) return show(signupMessage, 'unexpected error during signup', 'error');

  const { error: profileErr } = await supabaseClient.from('profiles').insert([
    { id: user.id, username, email }
  ]);
  if (profileErr) return show(signupMessage, profileErr.message, 'error');

  show(signupMessage, 'signup successful — redirecting...', 'success');
  setTimeout(() => window.location.href = '/' + encodeURIComponent(username), 900);
});

/* LOGIN */
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  loginMessage.textContent = '';

  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  if (!email || !password) return show(loginMessage, 'please provide email and password', 'error');

  const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
  if (error) return show(loginMessage, error.message, 'error');

  const user = data.user;
  if (!user) return show(loginMessage, 'login succeeded but user not found', 'error');

  const { data: profile, error: profileError } = await supabaseClient.from('profiles')
    .select('username').eq('id', user.id).single();

  if (profileError) return show(loginMessage, profileError.message, 'error');

  show(loginMessage, 'login successful — redirecting...', 'success');
  setTimeout(() => window.location.href = '/' + encodeURIComponent(profile.username), 800);
});
</script>
</body>
</html>
